import { useState, useEffect } from "react";
import axiosInstance from "utils/axiosInstance";
import styles from "./Chart.module.css";
import MyResponsiveBar from "./MyResponsiveBar";

const regions = {
  서울: {
    종로구: [
      "청운효자동",
      "사직동",
      "삼청동",
      "부암동",
      "평창동",
      "무악동",
      "교남동",
    ],
    중구: ["소공동", "회현동", "명동", "필동", "장충동", "광희동"],
    용산구: ["이태원동", "한남동", "보광동", "용산동", "효창동", "도원동"],
  },
  부산: {
    중구: ["중앙동", "동광동", "대청동", "보수동", "부평동", "신창동"],
    서구: ["동대신동", "서대신동", "부민동", "암남동", "아미동", "초장동"],
    동구: ["초량동", "수정동", "좌천동", "범일동"],
  },
  대구: {
    중구: ["동인동", "삼덕동", "성내동", "대신동", "남산동", "동산동"],
    동구: ["신암동", "신천동", "효목동", "지묘동", "동촌동", "안심동"],
    서구: ["비산동", "평리동", "원대동", "중리동", "내당동", "이현동"],
  },
  인천: {
    중구: ["신포동", "연안동", "신흥동", "선린동", "동인천동", "운서동"],
    동구: ["만석동", "화수동", "송현동", "송림동", "송학동", "창영동"],
    미추홀구: ["주안동", "학익동", "용현동", "도화동", "숭의동", "문학동"],
  },
  광주: {
    동구: ["대인동", "계림동", "산수동", "지산동", "서석동", "학동"],
    서구: ["양동", "농성동", "화정동", "상무동", "치평동", "유덕동"],
    남구: ["백운동", "주월동", "월산동", "진월동", "송하동", "봉선동"],
  },
  대전: {
    유성구: [
      "궁동",
      "어은동",
      "신성동",
      "봉명동",
      "장대동",
      "상대동",
      "노은동",
      "지족동",
      "구암동",
      "원신흥동",
    ],
    동구: [
      "중앙동",
      "신인동",
      "원동",
      "가오동",
      "판암동",
      "용운동",
      "대동",
      "자양동",
      "용전동",
      "성남동",
    ],
    중구: [
      "대흥동",
      "문창동",
      "은행동",
      "중촌동",
      "용두동",
      "대사동",
      "태평동",
      "목동",
      "오류동",
      "부사동",
    ],
    서구: [
      "괴정동",
      "둔산동",
      "탄방동",
      "가장동",
      "변동",
      "용문동",
      "월평동",
      "갈마동",
      "도마동",
      "정림동",
    ],
  },
  울산: {
    중구: ["반구동", "학산동", "성남동", "태화동", "남외동", "복산동"],
    남구: ["달동", "삼산동", "무거동", "야음동", "신정동", "옥동"],
    동구: ["전하동", "남목동", "방어동", "일산동", "화정동", "대송동"],
  },
  세종특별자치시: {
    조치원읍: ["조치원리", "장군면", "한솔동", "연동면", "연서면", "금남면"],
    연기면: ["연기리", "연서면", "연동면", "장군면", "금남면", "소정면"],
  },
  경기도: {
    수원시: ["권선구", "영통구", "장안구", "팔달구"],
    성남시: ["분당구", "수정구", "중원구"],
    고양시: ["덕양구", "일산동구", "일산서구"],
    안양시: ["만안구", "동안구"],
    부천시: ["오정구", "원미구", "소사구"],
    광명시: ["광명동", "철산동", "하안동"],
    평택시: ["팽성읍", "안중읍", "포승읍"],
    안산시: ["단원구", "상록구"],
    의정부시: ["의정부1동", "의정부2동", "의정부3동"],
    파주시: ["문산읍", "운정동", "탄현면"],
    김포시: ["김포1동", "김포2동", "고촌읍"],
    광주시: ["경안동", "곤지암읍", "오포읍"],
    이천시: ["창전동", "증포동", "중리동"],
    용인시: ["처인구", "기흥구", "수지구"],
    하남시: ["덕풍동", "미사동", "감일동"],
  },
  강원도: {
    춘천시: ["효자1동", "효자2동", "후평1동", "후평2동", "석사동", "퇴계동"],
    원주시: ["무실동", "명륜동", "단계동", "개운동", "봉산동", "행구동"],
    강릉시: ["옥천동", "임당동", "포남동", "초당동", "교동", "내곡동"],
    동해시: ["동호동", "발한동", "북평동", "천곡동", "송정동", "효가동"],
    태백시: ["황지동", "상장동", "장성동", "삼수동", "문곡동", "통리동"],
    속초시: ["영랑동", "노학동", "교동", "청호동", "대포동", "설악동"],
    삼척시: ["오분동", "남양동", "교동", "조비동", "하장면", "노곡면"],
    홍천군: ["홍천읍", "화촌면", "남면", "서석면", "북방면", "내촌면"],
    횡성군: ["횡성읍", "공근면", "서원면", "둔내면", "안흥면", "강림면"],
    영월군: ["영월읍", "상동읍", "김삿갓면", "주천면", "북면", "한반도면"],
    평창군: ["평창읍", "진부면", "봉평면", "용평면", "대관령면", "미탄면"],
    정선군: ["정선읍", "고한읍", "사북읍", "남면", "북면", "임계면"],
    철원군: ["철원읍", "김화읍", "갈말읍", "동송읍", "근남면", "근동면"],
    화천군: ["화천읍", "상서면", "하남면", "간동면", "북면"],
    양구군: ["양구읍", "동면", "남면", "방산면", "해안면"],
    인제군: ["인제읍", "기린면", "서화면", "상남면", "북면"],
    고성군: ["간성읍", "거진읍", "현내면", "죽왕면", "토성면", "수동면"],
    양양군: ["양양읍", "서면", "손양면", "현북면", "현남면", "강현면"],
  },
  충청북도: {
    청주시: ["상당구", "서원구", "흥덕구", "청원구"],
    충주시: ["주덕읍", "노은면", "앙성면", "중앙탑면", "신니면", "수안보면"],
    제천시: ["신백동", "하소동", "영서동", "의림동", "청전동", "명동"],
    보은군: ["보은읍", "속리산면", "장안면", "마로면", "탄부면", "삼승면"],
    옥천군: ["옥천읍", "동이면", "안남면", "안내면", "청산면", "이원면"],
    영동군: ["영동읍", "황간면", "용산면", "매곡면", "양산면", "추풍령면"],
    증평군: ["증평읍", "도안면"],
    진천군: ["진천읍", "덕산읍", "광혜원면", "초평면", "문백면", "이월면"],
    괴산군: ["괴산읍", "연풍면", "칠성면", "청천면", "감물면", "문광면"],
    음성군: ["음성읍", "감곡면", "소이면", "원남면", "맹동면", "대소면"],
    단양군: ["단양읍", "매포읍", "영춘면", "어상천면", "적성면", "가곡면"],
  },
  충청남도: {
    천안시: ["동남구", "서북구"],
    공주시: ["반포면", "사곡면", "신관동", "계룡면", "우성면", "탄천면"],
    보령시: ["대천동", "주포면", "웅천읍", "청소면", "청라면", "남포면"],
    아산시: ["온양1동", "온양2동", "온양3동", "온양4동", "온양5동", "온양6동"],
    서산시: ["석남동", "운산면", "해미면", "고북면", "부석면", "팔봉면"],
    논산시: ["강경읍", "연무읍", "성동면", "부적면", "연산면", "벌곡면"],
    계룡시: ["엄사면", "두마면", "금암면"],
    당진시: ["당진1동", "당진2동", "당진3동", "합덕읍", "송악읍", "면천면"],
    금산군: ["금산읍", "군북면", "남일면", "남이면", "남천면", "추부면"],
    부여군: ["부여읍", "규암면", "은산면", "외산면", "내산면", "옥산면"],
    서천군: ["서천읍", "마서면", "화양면", "기산면", "한산면", "종천면"],
    청양군: ["청양읍", "운곡면", "대치면", "정산면", "목면", "청남면"],
    홍성군: ["홍성읍", "광천읍", "홍북읍", "금마면", "홍동면", "구항면"],
    예산군: ["예산읍", "삽교읍", "대술면", "신양면", "광시면", "대흥면"],
    태안군: ["태안읍", "안면읍", "고남면", "근흥면", "소원면", "원북면"],
  },
  전라북도: {
    전주시: ["완산구", "덕진구"],
    군산시: ["옥구읍", "옥산면", "회현면", "임피면", "서수면", "대야면"],
    익산시: ["남중동", "마동", "동산동", "모현동", "송학동", "영등동"],
    정읍시: ["초산동", "연지동", "상교동", "수성동", "서부동", "농소동"],
    남원시: ["금동", "향교동", "도통동", "동충동", "왕정동", "신정동"],
    김제시: ["신풍동", "요촌동", "검산동", "하동", "서암동", "교동"],
    완주군: ["봉동읍", "삼례읍", "용진읍", "상관면", "이서면", "구이면"],
    진안군: ["진안읍", "용담면", "안천면", "동향면", "상전면", "백운면"],
    무주군: ["무주읍", "무풍면", "설천면", "적상면", "안성면", "부남면"],
    장수군: ["장수읍", "산서면", "번암면", "장계면", "천천면", "계남면"],
    임실군: ["임실읍", "청웅면", "운암면", "신평면", "성수면", "오수면"],
    순창군: ["순창읍", "풍산면", "금과면", "팔덕면", "쌍치면", "복흥면"],
    고창군: ["고창읍", "흥덕면", "성송면", "대산면", "공음면", "상하면"],
    부안군: ["부안읍", "주산면", "동진면", "백산면", "상서면", "하서면"],
  },
  전라남도: {
    목포시: ["용당동", "옥암동", "하당동", "상동", "산정동", "연산동"],
    여수시: ["돌산읍", "소라면", "여천동", "화양면", "율촌면", "소호동"],
    순천시: ["남내동", "매곡동", "풍덕동", "조곡동", "저전동", "왕지동"],
    나주시: ["나주읍", "공산면", "노안면", "다시면", "문평면", "세지면"],
    광양시: ["광양읍", "중마동", "광영동", "골약동", "태인동", "금호동"],
    담양군: ["담양읍", "가사문학면", "고서면", "금성면", "남면", "대덕면"],
    곡성군: ["곡성읍", "고달면", "옥과면", "겸면", "오곡면", "삼기면"],
    구례군: ["구례읍", "간전면", "광의면", "마산면", "문척면", "산동면"],
    고흥군: ["고흥읍", "도덕면", "두원면", "동강면", "대서면", "금산면"],
    보성군: ["보성읍", "겸백면", "문덕면", "미력면", "벌교읍", "복내면"],
    화순군: ["화순읍", "능주면", "도곡면", "동복면", "동면", "백아면"],
    장흥군: ["장흥읍", "관산읍", "대덕읍", "부산면", "안양면", "유치면"],
    강진군: ["강진읍", "군동면", "대구면", "도암면", "마량면", "병영면"],
    해남군: ["해남읍", "계곡면", "마산면", "문내면", "북일면", "북평면"],
    영암군: ["영암읍", "금정면", "덕진면", "도포면", "미암면", "삼호읍"],
    무안군: ["무안읍", "일로읍", "삼향읍", "청계면", "해제면", "현경면"],
    함평군: ["함평읍", "대동면", "나산면", "손불면", "신광면", "엄다면"],
    영광군: ["영광읍", "백수읍", "법성면", "불갑면", "군서면", "군남면"],
    장성군: ["장성읍", "남면", "동화면", "북이면", "북하면", "삼서면"],
    완도군: ["완도읍", "고금면", "군외면", "금당면", "넙도면", "보길면"],
    진도군: ["진도읍", "고군면", "군내면", "의신면", "임회면", "지산면"],
    신안군: ["압해읍", "암태면", "안좌면", "비금면", "도초면", "흑산면"],
  },
  경상북도: {
    포항시: ["남구", "북구"],
    경주시: ["중부동", "황성동", "선도동", "동천동", "용강동", "성건동"],
    김천시: ["아포읍", "봉산면", "율곡동", "대곡동", "신음동", "지좌동"],
    안동시: ["중구동", "명륜동", "옥동", "송하동", "용상동", "운안동"],
    구미시: ["원평동", "형곡동", "도량동", "공단동", "광평동", "옥계동"],
    영주시: ["영주동", "하망동", "휴천동", "가흥동", "문수면", "봉현면"],
    영천시: ["금호읍", "남부동", "동부동", "서부동", "중앙동", "화산면"],
    상주시: ["계림동", "냉림동", "동문동", "서문동", "성동동", "중앙동"],
    문경시: ["영순면", "동로면", "마성면", "가은읍", "농암면", "문경읍"],
    경산시: ["중방동", "사동", "정평동", "옥곡동", "자인면", "하양읍"],
    군위군: ["군위읍", "부계면", "삼국면", "소보면", "우보면", "효령면"],
    의성군: ["의성읍", "단촌면", "옥산면", "금성면", "봉양면", "비안면"],
    청송군: ["청송읍", "부남면", "파천면", "현동면", "현서면", "진보면"],
    영양군: ["영양읍", "입암면", "석보면", "청기면", "일월면", "수비면"],
    영덕군: ["영덕읍", "강구면", "남정면", "달산면", "병곡면", "영해면"],
    청도군: ["청도읍", "풍각면", "각남면", "각북면", "금천면", "매전면"],
    고령군: ["대가야읍", "다산면", "개진면", "쌍림면", "우곡면", "덕곡면"],
    성주군: ["성주읍", "가천면", "금수면", "대가면", "벽진면", "수륜면"],
    칠곡군: ["왜관읍", "북삼읍", "석적읍", "지천면", "동명면", "가산면"],
    예천군: ["예천읍", "감천면", "개포면", "보문면", "봉양면", "상리면"],
    봉화군: ["봉화읍", "법전면", "상운면", "석포면", "소천면", "재산면"],
    울진군: ["울진읍", "평해읍", "기성면", "금강송면", "노음면", "후포면"],
    울릉군: ["울릉읍", "서면", "북면"],
  },
  경상남도: {
    창원시: ["의창구", "성산구", "마산합포구", "마산회원구", "진해구"],
    진주시: ["성북동", "상봉동", "평거동", "칠암동", "판문동", "상대동"],
    통영시: ["도남동", "명정동", "무전동", "중앙동", "정량동", "서호동"],
    사천시: ["사천읍", "정동면", "곤양면", "곤명면", "사남면", "용현면"],
    김해시: ["삼계동", "삼방동", "삼정동", "불암동", "지내동", "내외동"],
    밀양시: ["내일동", "내이동", "교동", "삼문동", "가곡동", "활성동"],
    거제시: ["고현동", "장평동", "아주동", "양정동", "상문동", "장승포동"],
    양산시: ["중앙동", "덕계동", "명곡동", "매곡동", "물금읍", "동면"],
    의령군: ["의령읍", "가례면", "칠곡면", "대의면", "화정면", "용덕면"],
    함안군: ["함안읍", "군북면", "법수면", "대산면", "칠서면", "칠북면"],
    창녕군: ["창녕읍", "남지읍", "고암면", "성산면", "대합면", "이방면"],
    고성군: ["고성읍", "개천면", "구만면", "대가면", "동해면", "마암면"],
    남해군: ["남해읍", "고현면", "남면", "서면", "이동면", "상주면"],
    하동군: ["하동읍", "화개면", "악양면", "적량면", "진교면", "양보면"],
    산청군: ["산청읍", "차황면", "오부면", "생비량면", "금서면", "신등면"],
    함양군: ["함양읍", "마천면", "휴천면", "유림면", "수동면", "서상면"],
    거창군: ["거창읍", "신원면", "가조면", "가북면", "고제면", "북상면"],
    합천군: ["합천읍", "봉산면", "묘산면", "삼가면", "가회면", "대병면"],
  },
  제주특별자치도: {
    제주시: ["한림읍", "애월읍", "구좌읍", "조천읍", "한경면", "추자면"],
    서귀포시: ["남원읍", "표선면", "성산읍", "안덕면", "대정읍", "중문동"],
  },
};

const SurveyView = () => {
  const [selectedRegion, setSelectedRegion] = useState("");
  const [selectedCity, setSelectedCity] = useState("");
  const [selectedDistrict, setSelectedDistrict] = useState("");
  const [cities, setCities] = useState([]);
  const [districts, setDistricts] = useState([]);
  const [surveyResult, setSurveyResult] = useState([]);

  useEffect(() => {
    if (selectedRegion) {
      setCities(Object.keys(regions[selectedRegion]));
      setSelectedCity("");
      setSelectedDistrict("");
      setDistricts([]);
    }
  }, [selectedRegion]);

  useEffect(() => {
    if (selectedCity) {
      setDistricts(regions[selectedRegion][selectedCity]);
      setSelectedDistrict("");
    }
  }, [selectedCity, selectedRegion]);

  const handleConfirm = async () => {
    try {
      const response = await axiosInstance.get(`/surveys`, {
        params: {
          sido: selectedRegion,
          sigungu: selectedCity,
          dong: selectedDistrict,
        },
      });
      const sortedResult = response.data.sort(
        (a, b) => a.surveyCount - b.surveyCount
      );
      setSurveyResult(sortedResult);
      console.log(sortedResult);
    } catch (error) {
      console.error("Failed to fetch survey data:", error);
    }
  };

  return (
    <div className={styles.container}>
      <h2>지역 선택</h2>
      <div>
        <label>광역시/도: </label>
        <select
          value={selectedRegion}
          onChange={(e) => setSelectedRegion(e.target.value)}
        >
          <option value="">선택하세요</option>
          {Object.keys(regions).map((region) => (
            <option key={region} value={region}>
              {region}
            </option>
          ))}
        </select>
      </div>
      {selectedRegion && (
        <div>
          <label>시군구: </label>
          <select
            value={selectedCity}
            onChange={(e) => setSelectedCity(e.target.value)}
          >
            <option value="">선택하세요</option>
            {cities.map((city) => (
              <option key={city} value={city}>
                {city}
              </option>
            ))}
          </select>
        </div>
      )}
      {selectedCity && (
        <div>
          <label>읍면동: </label>
          <select
            value={selectedDistrict}
            onChange={(e) => setSelectedDistrict(e.target.value)}
          >
            <option value="">선택하세요</option>
            {districts.map((district) => (
              <option key={district} value={district}>
                {district}
              </option>
            ))}
          </select>
        </div>
      )}
      {selectedDistrict && (
        <div>
          <label>선택된 지역: </label>
          <span>
            {selectedRegion} {selectedCity} {selectedDistrict}
          </span>
        </div>
      )}
      <button onClick={handleConfirm}>확인하기</button>

      {surveyResult.length > 0 ? (
        <div>
          <h3>설문 결과:</h3>
          <div style={{ height: "500px" }}>
            <MyResponsiveBar data={surveyResult} />
          </div>
        </div>
      ) : (
        <div>아직 수요조사 수집 중이에요 😅</div>
      )}
    </div>
  );
};

export default SurveyView;
